package test;

import CodinGame.print;
import CodinGame.printErr;
import CodinGame.readline;
import Std.parseInt;

import Main;
using buddy.Should;
using StringTools;

@:access(Main)
class Tests extends buddy.BuddySuite {
	
	public function new() {
		
		describe( "Test getMaxLength", {
			
			it( "MaxLength []", {
				Main.getMaxLength( [] ).should.be( 0 );
			});
			
			it( "MaxLength ['a']", {
				Main.getMaxLength( ['a'] ).should.be( 1 );
			});
			
			it( "MaxLength ['a', 'ab']", {
				Main.getMaxLength( ['a', 'ab'] ).should.be( 2 );
			});
			
		});

		describe( "Test process", {

			it( "abracadabra", {
				final inputs = parse( abracadabra );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "abracadabra" );
			});

			it( "Hello World !", {
				final inputs = parse( helloWorld );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "Hello World !" );
			});

			it( "Extra bit at the end", {
				final inputs = parse( extraBitAtTheEnd );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "DECODE FAIL AT INDEX 186" );
			});
			
			it( "Missing first character", {
				final inputs = parse( missingFirstCharacter );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "DECODE FAIL AT INDEX 0" );
			});
			
			it( "Inception", {
				final inputs = parse( inception );
				Main.process( inputs.codes, inputs.encodedString ).should.be( inceptionResult );
			});
			
			it( "Poor table", {
				final inputs = parse( poorTable );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "A very poor table, anyway, your program should work !" );
			});
			
			it( "No table !", {
				final inputs = parse( noTable );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "DECODE FAIL AT INDEX 0" );
			});
			
			it( "Lonely character", {
				final inputs = parse( lonelyCharacter );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "zzzzzzzzzzzzzzz" );
			});
			
			it( "ASCII art", {
				final inputs = parse( asciiArt );
				Main.process( inputs.codes, inputs.encodedString ).should.be( asciiArtResult );
			});
			
			it( "Lorem ipsum", {
				final inputs = parse( loremIpsum );
				Main.process( inputs.codes, inputs.encodedString ).should.be( loremIpsumResult );
			});
			
			it( "Parallel or not ?", {
				final inputs = parse( parallelOrNot );
				Main.process( inputs.codes, inputs.encodedString ).should.be( parallelOrNotResult );
			});
			
			it( "Lonely character v2", {
				final inputs = parse( lonelyCharacterV2 );
				Main.process( inputs.codes, inputs.encodedString ).should.be( "1" );
			});
			
		});

	}

	function parse( input:String ) {
		final inputRows = input.split( "\n" );
		
		final codes:Map<String, Int> = [];
		var n = parseInt( inputRows[0] );
		for( i in 0...n ) {
			var inputs = inputRows[i + 1].split(' ');
			final b = inputs[0].trim();
			final c = parseInt(inputs[1]);

			codes.set( b, c );
		}
		final encodedString = inputRows[n + 1].trim();

		return { codes: codes, encodedString: encodedString };
	}

	static final abracadabra = "5
	1 97
	001 98
	000 114
	011 99
	010 100
	10010001011101010010001";

	static final helloWorld = "9
	011 32
	0011 33
	0010 114
	0001 100
	0000 101
	111 87
	110 72
	10 108
	010 111
	1100000101001001111101000101000010110011";

	static final extraBitAtTheEnd = "18
	11 32
	1001 97
	000011 98
	000010 99
	0011 100
	011 101
	000001 102
	00101 104
	000000 73
	00100 105
	10111 108
	1000 110
	00011 111
	10110 114
	010 116
	10101 118
	00010 120
	10100 58
	0000001000101011001101110010000111110100110110001001010110100111000011001000101110010101101000101011110111000001111000110000011101000101011110111000000010000110011011001111010011000100101";

	static final missingFirstCharacter = "14
	101 32
	0000 97
	0111 99
	01001 100
	11 101
	0110 105
	0101 108
	00111 109
	00110 110
	00101 112
	100 114
	00100 116
	00011 118
	00010 58
	0100000110000110000010101100100111101000101010101111010010110011001110110111001010111000010000000111001001110011";

	static final inception = "12
	0101 32
	1 48
	00 49
	011000 50
	011100 51
	01111 52
	011101 53
	0110011 54
	011011 55
	0110010 56
	011010 57
	0100 10
	01100001111010011101010111000110000100000000110001010111000111000100001001101010110100110110100000000111010101101001101001000011100010100110100000010101001000100100000011010100101100001000000000000010100101111010000111101010110110111000100110000000101001011101010000100100000101001011011010011000010101001011001001000000000010101011110111101000011000101000010100001000001010111101100110100100001010100000001000010010010101000001100001001001000101000001111010011001000101000001110101001001101010000011001101001000000100010101100100111010100100000000010100000110110100000000100010100000110100100110011010100011000000100001111001100000000111000010010010011001111000000100001001100111100110000111001001001100100001110011111000000111111100111000011000000001111001000000100100110011100111100110000000000110000001100100000000001111000000100000011100001110000111100111001000010011000000111100000011001110011111111100001110000000010010000000011111100111000011000000000010000111100000010000110010000001110000110010010011100000000001100001001110011000011100001110011111100110000000000000011001000000111111000000110010011100110010000111110010000001000000100001001110010000111000000000011111100100100001100100100100110011001000000100000010000";
	
	static final inceptionResult =
"24
000 32
111001 33
10100 97
111000 99
10001 100
110 101
011100 102
11111 104
10000 73
00111 105
101011 107
00110 108
11110 44
1001 110
1011 46
0110 111
101010 112
0101 114
00101 115
0100 116
011101 85
01111 117
11101 119
00100 121
1000010011110001101010100100001110110100100001001100010101001011000100000111000000010001100111100001011101010010001000010011111001110010111110000111011100011000110000100010110100111000011100100010000000001100011110101111000000100011001111101100001110110010111000110010101000111110011010001001100011000100000010011111110010111000000111001010001001011000001011101110110100010110001111100000010101100101010100100101110111011".replace( "\r", "" );

	static final poorTable = "23
	0000000001 65
	0000000100 98
	0000000111 103
	0000001101 110
	0000000000 32
	0000000011 33
	0000000110 101
	0000001001 107
	0000001100 109
	0000001111 112
	0000000101 100
	0000010101 119
	0000010001 115
	0000010100 118
	0000010000 114
	0000010011 117
	0000010110 121
	0000010010 116
	0000000010 97
	0000001000 104
	0000001011 108
	0000001110 111
	0000001010 44
	00000000010000000000000001010000000001100000010000000001011000000000000000001111000000111000000011100000010000000000000000000100100000000010000000010000000010110000000110000000101000000000000000000010000000110100000101100000010101000000001000000101100000001010000000000000000101100000001110000001001100000100000000000000000000111100000100000000001110000000011100000100000000000010000000110000000000000000010001000000100000000011100000010011000000101100000001010000000000000001010100000011100000010000000000100100000000000000000011";

	static final noTable = "0
	01111100001010000001011010000011111100000011111011100101010000010100";

	static final lonelyCharacter = "1
	0 122
	000000000000000";

	static final asciiArt = "6
	1 32
	001 67
	0100 85
	000 72
	0101 10
	011 79
	00100100100110001100010110110110111010011010010010010010011000110000101001111100011000101111011101001101001001111100011000010100111110000000000001011110111010011010010011111000000000000010100111110001100010111101110100110100100111110001100001010010010010011000110001011011011011101000100010001001001001001001100011000";

	static final asciiArtResult =
"CCCC H  H OOOO U  U CCCC H  H
C    H  H O  O U  U C    H  H
C    HHHH O  O U  U C    HHHH
C    H  H O  O U  U C    H  H
CCCC H  H OOOO UUUU CCCC H  H".replace( "\r", "" );

	static final loremIpsum = "35
	0100000111 67
	010000111 68
	0100000110 69
	0100000101 73
	1100000 10
	0100000100 76
	010000110 77
	010000101 78
	0100000011 79
	010000100 80
	0100000010 86
	001 32
	1000 97
	0100011 98
	01011 99
	01001 100
	111 101
	01000101 102
	1100001 103
	0100000001 104
	0001 105
	1101 108
	110001 44
	00001 109
	1010 110
	010100 46
	00000 111
	11001 112
	01000100 113
	1011 114
	0110 115
	0111 116
	1001 117
	010101 118
	0100000000 120
	010000010000000101111100001001000111001011010010000100101001000001101000001011001011000010111001100000001111011111000100101011000001010011011101011011111101111001101100110000100100011100100010110010110001101011000010011111101000101110101000010100001001011000000001101000100010100100101110000010110111000001011001010101111110100111101100111001111100100010110000010000001001001000010000011011110110011100011110101001100000010000011001110001100000001001010110000010100101011000110111010001011000100010000111001111101101001000111101110010101011111101000101110010110000101110011000000011110111001110000110111000010101000101001100001010000101000010110011010010110010001000011100111110110100100011110111001110010000001101001111101111100111010000010111110000100110111001011110111001000010010100011110110001010010010001011101010000101000001111011100001100011110111110000011111010001011100101000100100100010110001010010001100000001001010110000000001000010000001001000000011111001000101100000100000010010011000010110010101010001011110001110011111011000000110010100001010000110100011101011111101010000110001011011101001001010101111011001110001010001110011101100100001001101000010110110101010000101000000101110110011100010100011100111011001000010010100011000101000111111010010011001000011100010011000101001111110010110111010011100000011011100001110011111011001010110000010100110111010110111111011110011011110001001010010000011010000010110010100100011000000010011101100001011000110100001100000110011011101010001100010010101011111101001000001011101010001011111001101010011101110110000011010100111011101100000110100000010100010110100011001000111110100101000010100001000100000001100001101111101110110010110001011011100001110011111011001010001011111011000011111010011110010000111000001010100111011101100000101101110100100111001000001011011110000101000010100000011101101011000100101010110001011000110010110001101010000111000000100010010011110011100111110101000011100010100011100101100011110111001000011000110000110100001011000101001000101100011100110001011011110011011000111110100111001000010000010100111111011011000100110101000011001011111011110011011001101100010100100010101110011101100101100010000110010110010100110000001000011100000101011101011001011010001100001000101110111000101100010101011001110111001100101111000011111100101000100100110000000100110000010100010100011010000101000111001011001010000101000010110011010010110010001101000110101110100010010011110010001101000111110111000011100111001000000110100111110111110010001000011100111110110100100011110111010100001010000110100011101011111101010000110001010101000101111000111001000111001011010010000100110100000010101100000010011001000100100001100001000000000001000011001011000101100000011011101000101011000101111001010010001101000110000101100101101110100100100000010010001000000101000010100000101101000110000101101011100100001011010001010110001001100110111010100000101101110100100111001110110000101111110111000011100101010100000110110010111110011000011111000100110100001011011010010000010110101100010010100010110110001101011000010001110111011000001010101111110100010111110001110000010010111001111110111100010100010111110100100100101001100100010010000001001000100000001100111010111101100010101111101100010000111101111001011001010000101000011110010001011000101010111111010010000100000110111101100111000111100110100001011000011100010011010111010110011000100101011011100000101100110001011010111001010100";

static final loremIpsumResult =
"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin id tortor vel est euismod molestie.
Etiam convallis imperdiet velit sit amet gravida. Nunc imperdiet posuere lorem rutrum blandit. Cras et
elit quis diam commodo euismod ac vitae eros. Maecenas sed vestibulum nisl. Vestibulum bibendum, ante sed
semper consectetur, dolor diam lacinia urna, vel ornare nulla nulla non sapien. Phasellus semper fermentum
nulla sed porta. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.
Donec sagittis vulputate quam a finibus. Nunc in neque in erat posuere imperdiet. Maecenas vitae ipsum non
dui maximus sollicitudin ac sed odio. In accumsan, urna sed placerat volutpat, nisl orci fringilla velit,
ut eleifend dui odio ultrices metus. Duis vel molestie nisi, nec auctor arcu.".replace( "\r", "" );

	static final parallelOrNot = "5
	00 32
	111 10
	110 92
	10 124
	01 47
	011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110011110110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100111101100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001111011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110011110110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100111101100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001111011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110011110110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100111101100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001111011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110011110110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100111101100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001111011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110011110110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100111101100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001111011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110011110110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001000011010110000001100111101100100001101011000000110010000110101100000011001000011010110000001100100001101011000000110010000110101100000011001";

	static final parallelOrNotResult =
"/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/
/|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/  \\|\\  /|/".replace( "\r", "" );

	static final lonelyCharacterV2 = "1
	01000001000000010111110000100100011100101101001000010010100100000110100000101100101100001011100110000000111101111100010010101100000101001101110101101111110111100110110011000010010001110010001011001011000110101100001001111110100010111010100001010000100101100000000110100010001010010010111000001011011100000101100101010111111010011110110011100111110010001011000001000000100100100001000001101111011001110001111010100110000001000001100111000110000000100101011000001010010101100011011101000101100010001000011100111110110100100011110111001010101111110100010111001011000010111001100000001111011100111000011011100001010100010100110000101000010100001011001101001011001000100001110011111011010010001111011100111001000000110100111110111110011101000001011111000010011011100101111011100100001001010001111011000101001001000101110101000010100000111101110000110001111011111000001111101000101110010100010010010001011000101001000110000000100101011000000000100001000000100100000001111100100010110000010000001001001100001011001010101000101111000111001111101100000011001010000101000011010001110101111110101000011000101101110100100101010111101100111000101000111001110110010000100110100001011011010101000010100000010111011001110001010001110011101100100001001010001100010100011111101001001100100001110001001100010100111111001011011101001110000001101110000111001111101100101011000001010011011101011011111101111001101111000100101001000001101000001011001010010001100000001001110110000101100011010000110000011001101110101000110001001010101111110100100000101110101000101111100110101001110111011000001101010011101110110000011010000001010001011010001100100011111010010100001010000100010000000110000110111110111011001011000101101110000111001111101100101000101111101100001111101001111001000011100000101010011101110110000010110111010010011100100000101101111000010100001010000001110110101100010010101011000101100011001011000110101000011100000010001001001111001110011111010100001110001010001110010110001111011100100001100011000011010000101100010100100010110001110011000101101111001101100011111010011100100001000001010011111101101100010011010100001100101111101111001101100110110001010010001010111001110110010110001000011001011001010011000000100001110000010101110101100101101000110000100010111011100010110001010101100111011100110010111100001111110010100010010011000000010011000001010001010001101000010100011100101100101000010100001011001101001011001000110100011010111010001001001111001000110100011111011100001110011100100000011010011111011111001000100001110011111011010010001111011101010000101000011010001110101111110101000011000101010100010111100011100100011100101101001000010011010000001010110000001001100100010010000110000100000000000100001100101100010110000001101110100010101100010111100101001000110100011000010110010110111010010010000001001000100000010100001010000010110100011000010110101110010000101101000101011000100110011011101010000010110111010010011100111011000010111111011100001110010101010000011011001011111001100001111100010011010000101101101001000001011010110001001010001011011000110101100001000111011101100000101010111111010001011111000111000001001011100111111011110001010001011111010010010010100110010001001000000100100010000000110011101011110110001010111110110001000011110111100101100101000010100001111001000101100010101011111101001000010000011011110110011100011110011010000101100001110001001101011101011001100010010101101110000010110011000101101011100101010001000001000000010111110000100100011100101101001000010010100100000110100000101100101100001011100110000000111101111100010010101100000101001101110101101111110111100110110011000010010001110010001011001011000110101100001001111110100010111010100001010000100101100000000110100010001010010010111000001011011100000101100101010111111010011110110011100111110010001011000001000000100100100001000001101111011001110001111010100110000001000001100111000110000000100101011000001010010101100011011101000101100010001000011100111110110100100011110111001010101111110100010111001011000010111001100000001111011100111000011011100001010100010100110000101000010100001011001101001011001000100001110011111011010010001111011100111001000000110100111110111110011101000001011111000010011011100100100000100000001011111000010010001110010110100100001001010010000011010000010110010110000101110011000000011110111110001001010110000010100110111010110111111011110011011001100001001000111001000101100101100011010110000100111111010001011101010000101000010010110000000011010001000101001001011100000101101110000010110010101011111101001111011001110011111001000101100000100000010010010000100000110111101100111000111101010011000000100000110011100011000000010010101100000101001010110001101110100010110001000100001110011111011010010001111011100101010111111010001011100101100001011100110000000111101110011100001101110000101010001010011000010100001010000101100110100101100100010000111001111101101001000111101110011100100000011010011111011111001110100000101111100001001101110010 49
	01000001000000010111110000100100011100101101001000010010100100000110100000101100101100001011100110000000111101111100010010101100000101001101110101101111110111100110110011000010010001110010001011001011000110101100001001111110100010111010100001010000100101100000000110100010001010010010111000001011011100000101100101010111111010011110110011100111110010001011000001000000100100100001000001101111011001110001111010100110000001000001100111000110000000100101011000001010010101100011011101000101100010001000011100111110110100100011110111001010101111110100010111001011000010111001100000001111011100111000011011100001010100010100110000101000010100001011001101001011001000100001110011111011010010001111011100111001000000110100111110111110011101000001011111000010011011100101111011100100001001010001111011000101001001000101110101000010100000111101110000110001111011111000001111101000101110010100010010010001011000101001000110000000100101011000000000100001000000100100000001111100100010110000010000001001001100001011001010101000101111000111001111101100000011001010000101000011010001110101111110101000011000101101110100100101010111101100111000101000111001110110010000100110100001011011010101000010100000010111011001110001010001110011101100100001001010001100010100011111101001001100100001110001001100010100111111001011011101001110000001101110000111001111101100101011000001010011011101011011111101111001101111000100101001000001101000001011001010010001100000001001110110000101100011010000110000011001101110101000110001001010101111110100100000101110101000101111100110101001110111011000001101010011101110110000011010000001010001011010001100100011111010010100001010000100010000000110000110111110111011001011000101101110000111001111101100101000101111101100001111101001111001000011100000101010011101110110000010110111010010011100100000101101111000010100001010000001110110101100010010101011000101100011001011000110101000011100000010001001001111001110011111010100001110001010001110010110001111011100100001100011000011010000101100010100100010110001110011000101101111001101100011111010011100100001000001010011111101101100010011010100001100101111101111001101100110110001010010001010111001110110010110001000011001011001010011000000100001110000010101110101100101101000110000100010111011100010110001010101100111011100110010111100001111110010100010010011000000010011000001010001010001101000010100011100101100101000010100001011001101001011001000110100011010111010001001001111001000110100011111011100001110011100100000011010011111011111001000100001110011111011010010001111011101010000101000011010001110101111110101000011000101010100010111100011100100011100101101001000010011010000001010110000001001100100010010000110000100000000000100001100101100010110000001101110100010101100010111100101001000110100011000010110010110111010010010000001001000100000010100001010000010110100011000010110101110010000101101000101011000100110011011101010000010110111010010011100111011000010111111011100001110010101010000011011001011111001100001111100010011010000101101101001000001011010110001001010001011011000110101100001000111011101100000101010111111010001011111000111000001001011100111111011110001010001011111010010010010100110010001001000000100100010000000110011101011110110001010111110110001000011110111100101100101000010100001111001000101100010101011111101001000010000011011110110011100011110011010000101100001110001001101011101011001100010010101101110000010110011000101101011100101010001000001000000010111110000100100011100101101001000010010100100000110100000101100101100001011100110000000111101111100010010101100000101001101110101101111110111100110110011000010010001110010001011001011000110101100001001111110100010111010100001010000100101100000000110100010001010010010111000001011011100000101100101010111111010011110110011100111110010001011000001000000100100100001000001101111011001110001111010100110000001000001100111000110000000100101011000001010010101100011011101000101100010001000011100111110110100100011110111001010101111110100010111001011000010111001100000001111011100111000011011100001010100010100110000101000010100001011001101001011001000100001110011111011010010001111011100111001000000110100111110111110011101000001011111000010011011100100100000100000001011111000010010001110010110100100001001010010000011010000010110010110000101110011000000011110111110001001010110000010100110111010110111111011110011011001100001001000111001000101100101100011010110000100111111010001011101010000101000010010110000000011010001000101001001011100000101101110000010110010101011111101001111011001110011111001000101100000100000010010010000100000110111101100111000111101010011000000100000110011100011000000010010101100000101001010110001101110100010110001000100001110011111011010010001111011100101010111111010001011100101100001011100110000000111101110011100001101110000101010001010011000010100001010000101100110100101100100010000111001111101101001000111101110011100100000011010011111011111001110100000101111100001001101110010";

}

